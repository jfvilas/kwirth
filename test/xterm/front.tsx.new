import { useEffect, useRef } from "react";
import { Terminal } from "xterm";
import "xterm/css/xterm.css";

export default function BashTerminal() {
  const ref = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const term = new Terminal({
      cursorBlink: true,
      fontSize: 14,
      theme: { background: "#000" },
    });

    if (ref.current) term.open(ref.current);

    const pod = "nginx-test"; // tu pod
    const socket = new WebSocket(`ws://localhost:3001/?pod=${pod}`);

    socket.binaryType = "arraybuffer";

    socket.onopen = () => {
      term.writeln(`Conectado a bash en pod: ${pod}\r\n`);
    };

    socket.onmessage = (e) => {
      const data = typeof e.data === "string" ? e.data : new TextDecoder().decode(e.data);
      term.write(data);
    };

    term.onData((data) => {
      socket.send(data);
    });

    socket.onclose = () => term.writeln("\r\n[SesiÃ³n cerrada]");
    return () => socket.close();
  }, []);

  return <div ref={ref} style={{ height: "100vh", background: "#000" }} />;
}
